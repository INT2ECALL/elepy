<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
<div id="app">

    <div uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky; bottom: #transparent-sticky-navbar">
        <nav class="uk-navbar-container" uk-navbar style="position: relative; z-index: 980;">

            <div class="uk-navbar-left uk-logo">

                <div class="uk-navbar-right">
                    <ul class="uk-navbar-nav">
                        <li class="uk-active">
                            <a href="#">Active</a>
                        </li>
                        <li>
                            <a href="#">Parent</a>
                            <div class="uk-navbar-dropdown">
                                <ul class="uk-nav uk-navbar-dropdown-nav">
                                    <li class="uk-active">
                                        <a href="#">Active</a>
                                    </li>
                                    <li>
                                        <a href="#">Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Item</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="#">Item</a>
                        </li>
                    </ul>

                </div>


        </nav>
    </div>
    <div id="sidebar" class="uk-light uk-padding">
        <div class="models">
            <h2>Admin Panel</h2>
            <p v-for="model in models">
                <a v-on:click="selectedModel = model; getModelData()">((model.name))</a>
            </p>
        </div>
        <div class="sidebar-footer">


            <p>Designed &amp; Developed by
                <a href="https://ryansusana.com">Ryan Susana</a>
            </p>
        </div>

    </div>

    <div class="main-content">

        <div class="uk-container uk-position-relative placeholder">
            <div v-if="selectedModel==null" class="uk-container uk-container-small">
                <div class="content">
                    <h1>About Elepy</h1>

                    <div class="uk-column-1-2">

                        <p>Elepy is a Rest API generation tool for Java/Kotlin developed by
                            <a
                                    href="https://ryansusana.com">Ryan Susana</a>. It is extremely customizable! The
                            library
                            comes bundled with an admin control panel that lets you easily control your content. In a
                            way you can view it as a Headless Content Management System. But it's much more than that!
                        </p>
                        <p>Because it's backed by MongoDB, it's able to handle extremely complex objects with ease.
                            Every part of the generation library is customizable. That means that you can use Elepy to
                            handle really complicated application logic as well. Elepy AND its admin panel support the
                            use of plugins, an example being the built-in Image Upload module that allows you to store
                            images in Mongo.</p>
                    </div>
                </div>
            </div>

            <div v-if="selectedModel!=null" class="content">
                <h3 class="uk-card-title">((selectedModel.name))</h3>

                <div class="data-section">

                    <table class="uk-table uk-table-hover uk-table-divider">
                        <thead>
                        <tr>
                            <th v-for="field in selectedModel.fields" v-if="field.type != 'OBJECT' ">
                                ((field.pretty_name))
                            </th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr v-for="data in modelData">
                            <td v-for="field in selectedModel.fields"
                                v-on:click="selectedData = JSON.parse(JSON.stringify(data)); editModal()"
                                v-if="field.type != 'OBJECT' ">(( field.type == 'DATE'? toDate(data[field.name])
                                :data[field.name]))
                            </td>

                        </tr>
                        </tbody>


                    </table>
                </div>

                <div id="edit-modal" class="uk-modal-container" uk-modal>
                    <div class="uk-modal-dialog">

                        <div class="uk-modal-header">
                            <h2 class="uk-modal-title">Edit</h2>
                        </div>
                        <div class="uk-modal-body" uk-overflow-auto>
                            <form id="content-form" v-if="selectedData!=null" class="uk-form-stacked ">
                                <div class="uk-width-1-1">

                                    <div v-for="(field, index) in selectedModel.fields" v-if="field.type != 'OBJECT' "
                                         class="uk-margin">
                                        <label class="uk-form-label">((field.pretty_name))</label>
                                        <div class="uk-form-controls">
                                            <!-- TEXTFIELD -->
                                            <input class="uk-input"
                                                   v-if="field.type == 'STRING' || (field.type == 'TEXT' && field.textType == 'TEXTFIELD')"
                                                   :disabled="field.name == 'id' || (field.editable == false)"
                                                   v-model="selectedData[field.name]" type="text"
                                                   :disabled="field.name == 'id' || field.editable == false"
                                                   placeholder="">
                                            <!-- DATE -->
                                            <input :id="'date-form-field-'+index" class="uk-input"
                                                   v-if="field.type == 'DATE'"
                                                   :disabled="field.name == 'id' || (field.editable == false)"
                                                   v-on:blur="fromDate(field.name, index)"
                                                   v-bind:value="toDate(selectedData[field.name])"
                                                   type="date">
                                            <!-- NUMBER -->
                                            <input class="uk-input" v-if="field.type == 'NUMBER'"
                                                   :disabled="field.name == 'id' || (field.editable == false)"
                                                   v-model="selectedData[field.name]"
                                                   type="number">
                                            <!-- TEXTAREA -->

                                            <textarea class="uk-textarea"
                                                      v-if="(field.type == 'TEXT' && field.textType == 'TEXTAREA')"
                                                      :disabled="field.name == 'id' || (field.editable == false)"
                                                      v-model="selectedData[field.name]" type="text"
                                                      :disabled="field.name == 'id' || field.editable == false"
                                                      placeholder="" rows="5"></textarea>

                                            <!-- ENUM -->
                                            <div class="uk-form-controls">
                                                <select class="uk-select" v-model="selectedData[field.name]"
                                                        :disabled="field.name == 'id' || field.editable == false"
                                                        v-if="field.type == 'ENUM' ">
                                                    <option v-for="value in field.availableValues">((value))</option>

                                                </select>
                                            </div>


                                        </div>
                                    </div>
                                    <h3>More data (click to edit)</h3>
                                    <ul class="uk-margin-top" uk-accordion>
                                        <li v-for="(fieldOuter, index) in selectedModel.fields"
                                            v-if="fieldOuter.type == 'OBJECT' ">
                                            <a class="uk-accordion-title" href="#">((fieldOuter.pretty_name))</a>
                                            <div class="uk-accordion-content">
                                                <div v-for="(field, index) in fieldOuter.fields"
                                                     class="uk-form-controls">
                                                    <label class="uk-form-label">((field.pretty_name))</label>
                                                    <!-- TEXTFIELD -->
                                                    <input class="uk-input"
                                                           v-if="field.type == 'STRING' || (field.type == 'TEXT' && field.textType == 'TEXTFIELD')"
                                                           :disabled="field.name == 'id' || (field.editable == false)"
                                                           v-model="selectedData[fieldOuter.name][field.name]"
                                                           type="text"
                                                           :disabled="field.name == 'id' || field.editable == false"
                                                           placeholder="">
                                                    <!-- DATE -->
                                                    <input :id="'date-form-field-'+index" class="uk-input"
                                                           v-if="field.type == 'DATE'"
                                                           :disabled="field.name == 'id' || (field.editable == false)"
                                                           v-on:blur="fromDate(field.name, index)"
                                                           v-bind:value="toDate(selectedData[fieldOuter.name][field.name])"
                                                           type="date">
                                                    <!-- NUMBER -->
                                                    <input class="uk-input" v-if="field.type == 'NUMBER'"
                                                           :disabled="field.name == 'id' || (field.editable == false)"
                                                           v-model="selectedData[fieldOuter.name][field.name]"
                                                           type="number">
                                                    <!-- TEXTAREA -->

                                                    <textarea class="uk-textarea"
                                                              v-if="(field.type == 'TEXT' && field.textType == 'TEXTAREA')"
                                                              :disabled="field.name == 'id' || (field.editable == false)"
                                                              v-model="selectedData[fieldOuter.name][field.name]"
                                                              type="text"
                                                              :disabled="field.name == 'id' || field.editable == false"
                                                              placeholder=""
                                                              rows="5"></textarea>

                                                    <!-- ENUM -->
                                                    <div class="uk-form-controls">
                                                        <select class="uk-select"
                                                                v-model="selectedData[fieldOuter.name][field.name]"
                                                                :disabled="field.name == 'id' || field.editable == false"
                                                                v-if="field.type == 'ENUM' ">
                                                            <option v-for="value in field.availableValues">((value))
                                                            </option>

                                                        </select>
                                                    </div>


                                                </div>
                                            </div>
                                        </li>

                                    </ul>

                                </div>


                            </form>
                        </div>
                        <div class="uk-modal-footer uk-text-right">
                            <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                            <button class="uk-button uk-button-primary" v-on:click="saveData()" type="button">Save
                            </button>
                        </div>
                    </div>
                </div>


                <div id="add-modal" class="uk-modal-container" uk-modal>
                    <div class="uk-modal-dialog">

                        <div class="uk-modal-header">
                            <h2 class="uk-modal-title">Edit</h2>
                        </div>
                        <div class="uk-modal-body" uk-overflow-auto>
                            <form id="content-form" v-if="selectedData!=null" class="uk-form-stacked ">
                                <div class="uk-width-1-1">

                                    <div v-for="(field, index) in selectedModel.fields" v-if="field.type != 'OBJECT' "
                                         class="uk-margin">
                                        <label class="uk-form-label">((field.pretty_name))</label>
                                        <div class="uk-form-controls">
                                            <!-- TEXTFIELD -->
                                            <input class="uk-input"
                                                   v-if="field.type == 'STRING' || (field.type == 'TEXT' && field.textType == 'TEXTFIELD')"
                                                   :disabled="field.name == 'id' || (field.editable == false)"
                                                   v-model="selectedData[field.name]" type="text"
                                                   :disabled="field.name == 'id' || field.editable == false"
                                                   placeholder="">
                                            <!-- DATE -->
                                            <input :id="'date-form-field-'+index" class="uk-input"
                                                   v-if="field.type == 'DATE'"
                                                   :disabled="field.name == 'id' || (field.editable == false)"
                                                   v-on:blur="fromDate(field.name, index)"
                                                   v-bind:value="toDate(selectedData[field.name])"
                                                   type="date">
                                            <!-- NUMBER -->
                                            <input class="uk-input" v-if="field.type == 'NUMBER'"
                                                   :disabled="field.name == 'id' || (field.editable == false)"
                                                   v-model="selectedData[field.name]"
                                                   type="number">
                                            <!-- TEXTAREA -->

                                            <textarea class="uk-textarea"
                                                      v-if="(field.type == 'TEXT' && field.textType == 'TEXTAREA')"
                                                      :disabled="field.name == 'id' || (field.editable == false)"
                                                      v-model="selectedData[field.name]" type="text"
                                                      :disabled="field.name == 'id' || field.editable == false"
                                                      placeholder="" rows="5"></textarea>

                                            <!-- ENUM -->
                                            <div class="uk-form-controls">
                                                <select class="uk-select" v-model="selectedData[field.name]"
                                                        :disabled="field.name == 'id' || field.editable == false"
                                                        v-if="field.type == 'ENUM' ">
                                                    <option v-for="value in field.availableValues">((value))</option>

                                                </select>
                                            </div>


                                        </div>
                                    </div>
                                    <h3>More data (click to edit)</h3>
                                    <ul class="uk-margin-top" uk-accordion>
                                        <li v-for="(fieldOuter, index) in selectedModel.fields"
                                            v-if="fieldOuter.type == 'OBJECT' ">
                                            <a class="uk-accordion-title" href="#">((fieldOuter.pretty_name))</a>
                                            <div class="uk-accordion-content">
                                                <div v-for="(field, index) in fieldOuter.fields"
                                                     class="uk-form-controls">
                                                    <label class="uk-form-label">((field.pretty_name))</label>
                                                    <!-- TEXTFIELD -->
                                                    <input class="uk-input"
                                                           v-if="field.type == 'STRING' || (field.type == 'TEXT' && field.textType == 'TEXTFIELD')"
                                                           :disabled="field.name == 'id' || (field.editable == false)"
                                                           v-model="selectedData[fieldOuter.name][field.name]"
                                                           type="text"
                                                           :disabled="field.name == 'id' || field.editable == false"
                                                           placeholder="">
                                                    <!-- DATE -->
                                                    <input :id="'date-form-field-'+index" class="uk-input"
                                                           v-if="field.type == 'DATE'"
                                                           :disabled="field.name == 'id' || (field.editable == false)"
                                                           v-on:blur="fromDate(field.name, index)"
                                                           v-bind:value="toDate(selectedData[fieldOuter.name][field.name])"
                                                           type="date">
                                                    <!-- NUMBER -->
                                                    <input class="uk-input" v-if="field.type == 'NUMBER'"
                                                           :disabled="field.name == 'id' || (field.editable == false)"
                                                           v-model="selectedData[fieldOuter.name][field.name]"
                                                           type="number">
                                                    <!-- TEXTAREA -->

                                                    <textarea class="uk-textarea"
                                                              v-if="(field.type == 'TEXT' && field.textType == 'TEXTAREA')"
                                                              :disabled="field.name == 'id' || (field.editable == false)"
                                                              v-model="selectedData[fieldOuter.name][field.name]"
                                                              type="text"
                                                              :disabled="field.name == 'id' || field.editable == false"
                                                              placeholder=""
                                                              rows="5"></textarea>

                                                    <!-- ENUM -->
                                                    <div class="uk-form-controls">
                                                        <select class="uk-select"
                                                                v-model="selectedData[fieldOuter.name][field.name]"
                                                                :disabled="field.name == 'id' || field.editable == false"
                                                                v-if="field.type == 'ENUM' ">
                                                            <option v-for="value in field.availableValues">((value))
                                                            </option>

                                                        </select>
                                                    </div>


                                                </div>
                                            </div>
                                        </li>

                                    </ul>

                                </div>


                            </form>
                        </div>
                        <div class="uk-modal-footer uk-text-right">
                            <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                            <button class="uk-button uk-button-primary" v-on:click="createData()" type="button">Save
                            </button>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/js/uikit.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/js/uikit-icons.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    var app = new Vue({
        el: '#app',
        delimiters: ['((', '))'],
        data: {
            newData: {},
            selectedData: null,
            selectedModel: null,
            models: [],
            modelData: null

        },
        computed: {},

        methods: {
            fromDate: function (field, index) {
                this.selectedData[field] = document.getElementById('date-form-field-' + index).value

            },
            toDate: function (milli) {
                var date = new Date(milli);
                return date.yyyymmdd();
            },

            editModal: function () {
                UIkit.modal(document.getElementById("edit-modal")).show();
            },
            saveData: function () {
                var ref = this;
                axios({
                    method: 'put',
                    url: 'http://localhost:4567' + ref.selectedModel.slug,
                    data: ref.selectedData
                }).then(function (response) {
                    //console.log(response.data)
                    //ref.modelData = response.data
                    UIkit.modal(document.getElementById("edit-modal")).hide();
                    ref.getModelData();
                    UIkit.notification("Successfully updated the item!", {status: 'success'})

                })
                        .catch(function (error) {
                            console.log(error.response.status)
                            UIkit.notification(error.response.data, {status: 'danger'})

                        });

            },
            getModelData: function () {
                var ref = this;
                axios.get('http://localhost:4567' + ref.selectedModel.slug, {
                    params: {
                        admin: true
                    }
                })
                        .then(function (response) {
                            ref.modelData = response.data
                        })
                        .catch(function (error) {
                            UIkit.notification(error.response.status, {status: 'danger'})
                        });
            },

            getModels: function () {
                var ref = this;
                axios.get('http://localhost:4567/config', {
                    params: {
                        admin: true
                    }
                })
                        .then(function (response) {
                            ref.models = response.data
                        })
                        .catch(function (error) {
                            UIkit.notification(error.response.status, {status: 'danger'})
                        });
            }
        },
        created: function () {
            this.getModels();
        }
    })
    Date.prototype.yyyymmdd = function () {
        var mm = this.getMonth() + 1; // getMonth() is zero-based
        var dd = this.getDate();

        return [this.getFullYear(),
            (mm > 9 ? '-' : '-0') + mm,
            (dd > 9 ? '-' : '-0') + dd
        ].join('');
    };

</script>
</body>

</html>