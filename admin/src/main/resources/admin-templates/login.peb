<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css"
          integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
    <link rel="SHORTCUT ICON" href="https://cdn.jsdelivr.net/npm/elepy-style@1.1/images/favicon.png"/>

    <link rel="stylesheet" href="{{ cssLocation }}">
    <title>Elepy Admin Login</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.42/js/uikit-icons.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
            crossorigin="anonymous"></script>
</head>

<body>
<div class="login-section">

    <div class="uk-flex-center uk-flex">


        <div id="login-app"
             class="login-box uk-card uk-width-1-4@xl uk-width-2-5@m uk-width-1-2@s  uk-margin-large-top">


            <div class="uk-background-primary">
                <img src="{{ properties.logo }}"
                     alt="logo">
            </div>

            <div class="login-box-content uk-padding">

                <div v-if="initialUser">
                    <p>Login with your recently created user.</p>
                    <hr>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-stacked-text">Username</label>
                    <div class="uk-form-controls">
                        <input name="username" class="uk-input" v-model="username" type="text"
                               placeholder="Username">
                    </div>
                </div>


                <div class="uk-margin">
                    <label class="uk-form-label" for="form-stacked-text">Password</label>
                    <div class="uk-form-controls">
                        <input name="password" class="uk-input" v-on:keyup.enter="login" v-model="password"
                               type="password"
                               placeholder="Password">
                    </div>
                </div>

                <div class="uk-margin uk-margin-small-left">
                    <label><input class="uk-checkbox" v-model="keepLoggedIn" type="checkbox" checked> Remain logged
                        in</label>
                </div>
                <div class="uk-flex uk-flex-center">
                    <button id="login-button" v-on:click="login" class="uk-button uk-button-primary">Login</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% include "admin-templates/scripts.peb"%}

<script>

    const app = new Vue({
        delimiters: ['((', '))'],
        el: "#login-app",
        data: {

            username: "",
            password: "",
            keepLoggedIn: false,
            initialUser: false
        },
        created: function () {
            this.initialUser = this.getQueryParams("initialUser") != null
        },
        methods: {

            getQueryParams: function (qs) {
                let url_string = window.location.href;
                let url = new URL(url_string);
                return url.searchParams.get(qs)
            },

            login: function () {

                let selfReference = this;
                axios.post("/elepy-token-login", null, {
                    params: {
                        "keepLoggedIn": selfReference.keepLoggedIn
                    },
                    auth: {
                        "username": selfReference.username,
                        "password": selfReference.password,
                    }
                }).then(function (response) {
                    window.location = "/admin"

                })
                        .catch(function (error) {
                            console.log(error.response.status);
                            UIkit.notification(error.response.data.message, {status: 'danger'})

                        });
            }
        }
    });
</script>
</body>

</html>